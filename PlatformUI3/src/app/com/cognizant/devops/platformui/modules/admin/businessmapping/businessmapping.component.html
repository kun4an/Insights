<!--
 *********************************************************************************
 * Copyright 2019 Cognizant Technology Solutions
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *******************************************************************************
-->
<div class="pageCss">
  <div layout layout-align="left" class="titleStyle">
    <div>Configuration |
      <a class="greenTitleTxt">Business Mapping </a>
    </div>
  </div>

  <div class="orangeStripCss"></div>

  <div layout layout-align="left" class="sectionHeadingStyle">
    <div layout> &nbsp;Create Business Mapping Labels for a Tool
      <span class="sectionSubHeading"> (Add/Edit/Delete Business Mapping Labels for the Tools) </span>
    </div>
  </div>
  <div class="arrange-horizontally">
    <label class="mainText"> Select Tool </label>
    <mat-select [(ngModel)]="selectedAgent" [style.height.px]="20" [style.width.%]="21" (ngModelChange)="getAgentMappingDetail(selectedAgent)"
      name="selectedAgent" required placeholder="Select Tool" [ngClass]="{  'input-disabled' :false  ,  'form-control': true}">
      <mat-option *ngFor="let data of agentList" [value]="data" style="color:#0033A0">
        {{data.toolName}}
      </mat-option>
      </mat-select>
      <h2 class="labelInfo">(Please select a Tool to see the properties and create a Business Mapping Label)</h2>
  </div>

  <div class="subHeadingStyle" *ngIf="subHeading!='' ">
    <div class="subLabelInfo">{{subHeading}}
      <!--<span class="sectionSubHeading"> (Please note: If there are multiple Matches to a label while data collection, then the label will be applied to the first match found) 
      </span>-->
    </div>
  </div>

  <div *ngIf="(selectedAgent!=undefined)">
    <div class="btnAlign">
      <button mat-icon-button (click)="addAgentLabelData()" [disabled]="(selectedAgent==undefined)||disableAdd">
        <mat-icon title="Add Agent Label " class="mat-icon material-icons">
          add_circle
        </mat-icon>
        <mat-icon svgIcon="lineInButton" class="mat-icon material-icons">
        </mat-icon>
      </button>
      <button mat-icon-button (click)="editData()" [disabled]="!isEditData || (selectedMappingAgent==undefined)">
        <mat-icon title="Edit " class="mat-icon material-icons "> 
          edit
        </mat-icon>
      </button>
      <button mat-icon-button (click)="saveData()" [disabled]="isListView">
        <mat-icon title="Save " class="mat-icon material-icons">
          save
        </mat-icon>
      </button>
      <button mat-icon-button [disabled]="!isEditData || (selectedMappingAgent==undefined)" (click)="deleteMapping()">
        <mat-icon title="Delete " class="mat-icon material-icons" >
          delete
        </mat-icon>
     </button>
    </div>

    <div *ngIf="isListView">
      <mat-radio-group [(ngModel)]="selectedMappingAgent">
        <table mat-table [dataSource]="agentDataSource" class="mat-elevation-z8 ">
          <!-- Radio Button Column -->
          <ng-container matColumnDef="radio">
            <th mat-header-cell *matHeaderCellDef class="tableHeaderCss" style="width:10% !important "></th>
            <td mat-cell class="listTable" *matCellDef="let element" style="width:10% !important">
              <mat-radio-button [value]="element" color="primary" (click)="statusEdit(element) "></mat-radio-button>
            </td>
          </ng-container>
          <!-- OS Column -->
          <ng-container matColumnDef="mappinglabel">
            <th mat-header-cell *matHeaderCellDef class="tableHeaderCss">Business Mapping Label</th>
            <td mat-cell class="listTable" *matCellDef="let element" style="width:20% !important"> {{element.businessmappinglabel}} </td>
          </ng-container>
          <ng-container matColumnDef="properties">
            <th mat-header-cell *matHeaderCellDef class="tableHeaderCss"> {{selectedAgent.toolName}} Properties (PropertyName:Property
              Value)</th>
            <td mat-cell class="listTable" *matCellDef="let element" style="width:51% !important ">
              <div [innerHTML]="element.propertiesString">
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"> </tr>
        </table>
      </mat-radio-group>
      <div *ngIf="agentDataSource.length == 0">No records found</div>
    </div>
    <div *ngIf="noToolsData" class="noToolsData">
       <b>{{selectedAgent.toolName}}</b> does not have any Business Mapping Label, Please click on the<b> "ADD"</b> icon to create new Business Mapping Label.
    </div>
    <div *ngIf="!isListView">
      <table mat-table [dataSource]="agentPropertyDataSource" class="mat-elevation-z8 ">
        <ng-container matColumnDef="checkbox">
          <th mat-header-cell *matHeaderCellDef class="tableHeaderCss" style="width:10% !important ">
            <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="selection.hasValue() && isAllSelected()" [indeterminate]="selection.hasValue() && !isAllSelected() ">
            </mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let row" style="width:10% !important">
            <mat-checkbox (click)="$event.stopPropagation() " (change)="$event ? selection.toggle(row) : null" [checked]="selection.isSelected(row)">
            </mat-checkbox>
          </td>
        </ng-container>

        <!--Properties  Column -->
        <ng-container matColumnDef="toolproperties">
          <th mat-header-cell *matHeaderCellDef class="tableHeaderCss"> {{selectedAgent.toolName}} (Property Name)</th>
          <td mat-cell *matCellDef="let element"> {{element.key}} </td>
        </ng-container>

        <!-- Value Column -->
        <ng-container matColumnDef="propertyValue">
          <th mat-header-cell *matHeaderCellDef class="tableHeaderCss"> {{selectedAgent.toolName}} (Please input a Property Value)</th>
          <td mat-cell style="padding-top:10px;margin-left: 0px" *matCellDef="let element">
            <input [(ngModel)]="element.value" ref-value="ngModel" name="{{element.value}}" [ngClass]="{ 'input-disabled' : !element.editProperties  ,'form-control': element.editProperties} "
              required>
          </td>
        </ng-container>

        <!-- Label Column -->
        <ng-container matColumnDef="propertyLabel">
          <th mat-header-cell *matHeaderCellDef class="tableHeaderCss"> Business Mapping Label </th>
          <td mat-cell *matCellDef="let element;let i=index" [attr.rowspan]="getRowSpan('label',i)" [style.display]="getRowSpan( 'label', i) ? '' : 'none' ">
            <span>Guidelines to create the Business Mapping Label:
              <ol>
                <li>Label should be seperated by a colon ':'</li>
                <li>Label name should not contain 'space'</li>
                <li>Only '_' , '-' special characters are allowed</li> 
              </ol>   
            </span>
            <input [(ngModel)]="label" #labelText="ngModel" name="label" placeholder="Input a name for the Business Mapping Label" [ngClass]="{ 'input-disabled-label' :false ,'form-control-label': true} "
              required>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedToolColumns"></tr>
        <tr mat-row showRow *matRowDef="let row; columns: displayedToolColumns;">
        </tr>
      </table>
      <div *ngIf="noToolsPropertyData" class="noToolsData">
        No properties were found for the selected Tool <b> {{selectedAgent.toolName}} </b>. Please go to the Agent Management
        section to Edit or Update the selected Tool <b> {{selectedAgent.toolName}} </b> to add tool properties.
      </div>
    </div>
  </div>